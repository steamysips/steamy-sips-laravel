(()=>{"use strict";const t=function(){function t(){return JSON.parse(localStorage.getItem("cart")||"[]")}return{addItem:function(e){const n=t();let o=!1;for(let t=0;t<n.length;t++){const r=n[t];r.productID===e.productID&&r.cupSize===e.cupSize&&r.milkType===e.milkType&&(o=!0,r.quantity+=e.quantity)}o||n.push(e),localStorage.setItem("cart",JSON.stringify(n))},isEmpty:function(){return 0===t().length},getItems:t,removeItem:function(e){const n=t().filter((t=>{return n=t,o=e,!(JSON.stringify(n)===JSON.stringify(o));var n,o}));localStorage.setItem("cart",JSON.stringify(n))},clear:function(){localStorage.setItem("cart","[]")}}};function e(e){const n=e.target.parentNode.parentNode,o=(c=parseInt(n.getAttribute("data-productid"),10),u=parseInt(n.getAttribute("data-quantity"),10),s=n.getAttribute("data-cupsize"),d=n.getAttribute("data-milktype"),{productID:c,quantity:u,cupSize:s,milkType:d}),r=parseInt(e.target.value,10),a=parseFloat(n.getAttribute("data-unitprice")),i=Math.round(r*a*100)/100;var c,u,s,d;let l=parseFloat(document.querySelector("#cart-total").textContent);l+=a*(r-o.quantity),document.querySelector("#cart-total").textContent=l.toFixed(2).toString(),n.querySelector(".container > strong").textContent="Rs "+i,n.setAttribute("data-quantity",r);const y=t();y.removeItem(o),r>0&&(o.quantity=r,y.addItem(o))}async function n(){document.querySelector("#checkout-btn").setAttribute("aria-busy","true");const e=t(),n={items:e.getItems(),store_id:document.querySelector("#store_location").value},o=await fetch(window.location.href+"/checkout",{method:"POST",body:JSON.stringify(n)});if(document.querySelector("#checkout-btn").removeAttribute("aria-busy"),o.ok)return e.clear(),void document.querySelector("#my-modal").setAttribute("open","");const r=await o.json();window.alert(r.error)}function o(t){t.preventDefault()}window.addEventListener("DOMContentLoaded",(async function(){const r=t().getItems(),a=await fetch(window.location.href+"/upload",{method:"POST",body:JSON.stringify(r)});await new Promise((t=>setTimeout(t,1e3))),a.ok&&(document.body.innerHTML=await a.text(),function(){const t=[...document.querySelectorAll("section input[type='number']")],r=document.querySelector("#checkout-btn");null!==r&&r.addEventListener("click",n),t.forEach((t=>{t.addEventListener("change",e),t.addEventListener("keydown",o)}))}())}))})();